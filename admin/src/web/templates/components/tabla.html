{% from 'components/iconos.html' import dropdown_icon, search_icon,
ordering_icon, chevron_left_icon, sliders_horizontal_icon, plus_icon %} {%
macro tabla(configuracion, resultados, cant_resultados, cant_paginas, pagina, orden, ordenar_por) %}

<div id="tabla"
  class="flex flex-col bg-white dark:bg-neutral-800 rounded-xl border dark:border-neutral-700 divide-y divide-gray-200 dark:divide-neutral-700 overflow-hidden">
  <div class="flex items-center space-x-2 px-6 py-4">
    <!-- Boton crear -->
    {% if configuracion.crear %}
    <a href="{{ configuracion.crear.url }}" class="btn btn-primary py-1.5 px-3 gap-1">
      {{ plus_icon('size-4') }} {{ configuracion.crear.nombre }}
    </a>
    {% endif %}
    <!-- Busqueda -->
    {% if configuracion.busqueda %}
    <div class="flex-0">
      <div class="relative max-w-xs">
        <label for="tabla-busqueda" class="sr-only">Search</label>
        <input type="text" name="tabla-busqueda" id="tabla-busqueda"
          class="py-1.5 px-8 ps-10 block w-full border-transparent shadow-sm rounded-lg text-sm focus:z-10 bg-gray-100 focus:ring-blue-500 focus:border-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-700 dark:text-neutral-300 dark:placeholder-neutral-400 dark:focus:border-transparent dark:focus:ring-blue-600"
          placeholder="Buscar" />
        <div class="absolute inset-y-0 start-0 flex items-center pointer-events-none ps-3">
          {{search_icon("size-4 text-gray-500 dark:text-neutral-400")}}
        </div>
      </div>
    </div>
    {% endif %}
    <!-- Filtros -->
    <div class="flex-1 flex items-center justify-end space-x-2">
      {% if configuracion.filtros %}
      <div class="hs-dropdown [--auto-close:inside] [--placement:bottom-right] relative sm:inline-flex z-20">
        <button id="hs-dropdown-filtro" type="button"
          class="hs-dropdown-toggle btn btn-outline text-xs py-2 px-2.5 gap-x-1.5">
          {{sliders_horizontal_icon('size-[14px] dark:text-neutral-300')}}
          Filtrar {{dropdown_icon()}}
        </button>

        <div
          class="dropdown hs-dropdown-menu transition-[opacity,margin] duration hs-dropdown-open:opacity-100 opacity-0 hidden"
          aria-labelledby="hs-dropdown-filtro">
          <div class="space-y-4">
            {% for filtro in configuracion.filtros %}
            <div>
              <label for="tabla-filtro-{{ loop.index }}" class="block text-sm mb-1 dark:text-white">
                {{ filtro.nombre }}
              </label>
              {% if filtro.tipo == 'texto' %}
              <input type="text" id="tabla-filtro-{{ loop.index }}" placeholder="Escriba un valor"
                value="{{filtro.valor}}" />
              {% elif filtro.tipo == 'seleccion' %}
              <select id="tabla-filtro-{{ loop.index }}">
                <option value="">Seleccione una opci√≥n</option>
                {% for opcion in filtro.opciones %}
                <option value="{{ opcion }}" {% if ( opcion|trim|lower==filtro.valor|trim|lower ) %} selected {% endif
                  %}>
                  {{ opcion }}
                </option>
                {% endfor %}
              </select>
              {% elif filtro.tipo == 'fecha' %}
              <input type="date" id="tabla-filtro-{{ loop.index }}" value="{{filtro.valor}}" />
              {% endif %}
            </div>
            {% endfor %}
            <button type="button"
              class="w-full text-center py-2 px-4 inline-flex items-center justify-center gap-x-2 text-sm font-medium rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700 focus:outline-none focus:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none"
              onclick="filtrarTabla()"> Filtrar </button>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  <div class="overflow-x-auto min-h-[300px]">
    <div class="min-w-full inline-block align-middle">
      <div class="overflow-hidden">
        <table class="min-w-full">
          <!-- Headers -->
          <thead id="tabla-encabezado" class="uppercase border-b border-gray-200 dark:border-neutral-700">
            <tr>
              {% for encabezado in configuracion.encabezados %}
              <th scope="col"
                class="py-1 px-4 group text-start text-xs font-semibold text-gray-500 dark:text-neutral-500 focus:outline-none">
                {% if encabezado.ordenar %}
                <button
                  class="group py-1.5 px-2 inline-flex items-start hover:bg-gray-100 uppercase dark:hover:bg-neutral-700/50 rounded-md w-max"
                  onclick="ordenarTabla('{{ encabezado.id }}')">
                  {{ encabezado.nombre }}
                  {% if encabezado.id == ordenar_por %}
                  {{ ordering_icon('orden-activo-' + orden) }}
                  {% else %}
                  {{ ordering_icon() }}
                  {% endif %}
                </button>
                {% else %}
                <div class="px-2 uppercase">{{ encabezado.nombre }}</div>
                {% endif %}
              </th>
              {% endfor %} {% if configuracion.acciones %}
              <th scope="col"
                class="py-1 px-6 text-start text-xs font-semibold text-gray-800 dark:text-neutral-200 focus:outline-none">
              </th>
              {% endif %}
            </tr>
          </thead>

          <!-- Resultados -->
          <tbody id="tabla-body" class="divide-y divide-gray-200 dark:divide-neutral-700">
            {% for fila in resultados %}
            <tr class="hover:bg-gray-100/70 dark:hover:bg-neutral-700/20">
              {% set fila_dict = fila.to_dict() %}
              {% for key, value in fila_dict.items() %}
              <td class="size-px whitespace-nowrap">
                <div class="px-6 py-2 text-sm text-gray-800 dark:text-neutral-200">
                  {{ value }}
                </div>
              </td>
              {% endfor %}
              {% if configuracion.acciones %}
              <td class="size-px whitespace-nowrap">
                <div class="flex gap-1 px-4 justify-end">
                  {% for accion in configuracion.acciones %}
                  <button type="button"
                    class="py-1 px-2 inline-flex items-center justify-center gap-x-2 text-sm font-medium rounded-lg disabled:opacity-50 disabled:pointer-events-none text-blue-600 hover:bg-blue-100 hover:text-blue-800 focus:outline-none focus:bg-blue-100 focus:text-blue-800 dark:text-blue-500 dark:hover:bg-blue-800/30 dark:hover:text-blue-400 dark:focus:bg-blue-800/30 dark:focus:text-blue-400"
                    onclick="{{ accion.funcion }}('{{ fila.id }}')">
                    {{ accion.icono }} {{ accion.nombre }}
                  </button>
                  {% endfor %}
                </div>
              </td>
              {% endif %}
            </tr>
            {% else %}
            <tr>
              <td class="size-px whitespace-nowrap" colspan="{{ configuracion.encabezados|length + 1 }}">
                <div
                  class="py-10 px-5 flex flex-col justify-center items-center text-center text-gray-600 dark:text-neutral-500">
                  {{ search_icon("size-6") }}
                  <div class="max-w-sm mx-auto">
                    <p class="mt-2 text-sm">No se encontraron resultados</p>
                  </div>
                </div>
              </td>
            </tr>
            {% endfor %}

          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div
    class="px-6 py-4 grid gap-3 sm:flex sm:justify-between sm:items-center border-t border-gray-200 dark:border-neutral-700">
    <div>
      <p class="text-sm text-gray-600 dark:text-neutral-400">
        <span id="cantidad-resultados" class="font-semibold text-gray-800 dark:text-neutral-200">{{ cant_resultados }}
        </span>
        resultados
      </p>
    </div>

    <div class="flex gap-x-1">
      {% set botonPaginacionClases = 'size-9 justify-center inline-flex items-center gap-x-2 text-sm font-medium
      rounded-lg border-gray-200 text-gray-800 focus:outline-none focus:bg-gray-100 disabled:opacity-50
      disabled:pointer-events-none dark:border-neutral-700 dark:text-white'%}
      {% set botonPaginacionActivo = 'bg-gray-200 dark:bg-neutral-700' %}
      {% set botonPaginacionInactivo = 'bg-white dark:bg-neutral-800 hover:bg-gray-100 dark:hover:bg-neutral-700/50' %}
      <button type="button" id="tabla-anterior-pagina" {% if pagina==1 %} disabled {% endif %}
        onclick="cambiarPaginaTabla('{{ pagina - 1 }}')"
        class="{{ botonPaginacionClases }} {{ botonPaginacionInactivo }}">
        {{ chevron_left_icon('size-3') }}
      </button>
      <div id="tabla-paginacion" class="flex gap-x-1">
        {% for i in range(1, cant_paginas + 1) %}
        <button type="button" class="
        {{ botonPaginacionClases }} 
        {% if (i == pagina) %} 
          {{ botonPaginacionActivo }}
        {% else %} 
          {{ botonPaginacionInactivo }} 
        {% endif %} 
        " onclick="cambiarPaginaTabla('{{ i }}')">
          {{ i }}
        </button>
        {% endfor %}
      </div>
      <button type="button" id="tabla-siguiente-pagina" {% if pagina==cant_paginas %} disabled {% endif %}
        onclick="cambiarPaginaTabla('{{ pagina + 1 }}')"
        class="{{ botonPaginacionClases }} {{ botonPaginacionInactivo }}">
        {{ chevron_left_icon('size-3 rotate-180') }}
      </button>
    </div>
  </div>
</div>

<script>
  function cambiarPaginaTabla(pagina) {
    let url = new URL(window.location.href);
    url.searchParams.set('pagina', pagina);
    window.location.href = url.toString();
  }

  function ordenarTabla(columna) {
    let url = new URL(window.location.href);
    let ordenar_por = url.searchParams.get('ordenar_por');
    let orden = url.searchParams.get('orden');
    if (ordenar_por == columna && orden == 'asc') {
      url.searchParams.set('orden', 'desc');
    } else if (ordenar_por == columna && orden == 'desc') {
      url.searchParams.delete('orden');
      url.searchParams.delete('ordenar_por');
    } else {
      url.searchParams.set('orden', 'asc');
      url.searchParams.set('ordenar_por', columna);
    }
    window.location.href = url.toString();
  }

  function filtrarTabla() {
    let url = new URL(window.location.href);
    // {% if configuracion.filtros %}
    let valor;
    // {% for filtro in configuracion.filtros %}
    valor = document.getElementById('tabla-filtro-{{ loop.index }}').value;
    if (valor) {
      url.searchParams.set('{{ filtro.id }}', valor);
    } else {
      url.searchParams.delete('{{ filtro.id }}');
    }
    // {% endfor %}
    // {% endif %}
    window.location.href = url.toString();
  }
</script>

{% endmacro %}