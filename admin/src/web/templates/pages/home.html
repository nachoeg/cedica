{% from 'components/datatable.html' import datatable %}

{% extends "layouts/base.html" %}

{% block title %} Inicio {% endblock %}

{% block head %}
{{ super() }}
{% endblock %}

{% set data = {
'headers': ['Nombre', 'Edad', 'Correo', 'Actividad', 'Fecha', 'Hora', 'Estado', 'Telefono'],
'data': [
['Juan', 20, 'juan@mail.com', 'Correr', '2020-10-10', '10:00', 'Activo', '1234567890'],
['Pedro', 25, 'pedro@mail.com', 'Nadar', '2021-10-10', '10:00', 'Inactivo', '1234567890'],
['Maria', 30, 'maria@mail.com', 'Caminar', '2021-10-10', '10:00', 'Activo', '1234567890'],
['Jose', 35, 'jose@mail.com', 'Correr', '2021-10-10', '10:00', 'Inactivo', '1234567890'],
['Ana', 40, 'ana@mail.com', 'Nadar', '2021-10-10', '10:00', 'Activo', '1234567890'],
['Carlos', 45, 'carlos@mail.com', 'Caminar', '2021-10-10', '10:00', 'Inactivo', '1234567890'],
['Laura', 50, 'laura@mail.com', 'Correr', '2021-10-10', '10:00', 'Activo', '1234567890'],
['Luis', 55, 'luis@mail.com', 'Nadar', '2021-10-10', '10:00', 'Inactivo', '1234567890'],
['Sofia', 60, 'sofia@mail.com', 'Caminar', '2021-10-10', '10:00', 'Activo', '1234567890'],
['Diego', 65, 'diego@mail.com', 'Correr', '2021-10-10', '10:00', 'Inactivo', '1234567890'],
['Maria', 70, 'maria@mail.com', 'Caminar', '2021-10-10', '10:00', 'Activo', '1234567890'],
['Andres', 75, 'andres@mail.com', 'Nadar', '2021-10-10', '10:00', 'Inactivo', '1234567890'],
['Julia', 80, 'julia@mail.com', 'Correr', '2021-10-10', '10:00', 'Activo', '1234567890'],
['Roberto', 85, 'roberto@mail.com', 'Caminar', '2021-10-10', '10:00', 'Inactivo', '1234567890'],
['Isabel', 90, 'isabel@mail.com', 'Nadar', '2021-10-10', '10:00', 'Activo', '1234567890'],
['Fernando', 95, 'fernando@mail.com', 'Correr', '2021-10-10', '10:00', 'Inactivo', '1234567890'],
['Carolina', 100, 'carolina@mail.com', 'Caminar', '2021-10-10', '10:00', 'Activo', '1234567890'],
['Ricardo', 105, 'ricardo@mail.com', 'Nadar', '2021-10-10', '10:00', 'Inactivo', '1234567890'],
['Gabriela', 110, 'gabriela@mail.com', 'Correr', '2021-10-10', '10:00', 'Activo', '1234567890']],
'actions': ['Borrar', 'Editar', 'Bloquear', 'Ver', 'Descargar'],
'filters': [{'label': 'Nombre', 'tipo': 'texto' }, {'label': 'Estado', 'tipo': 'seleccion', 'opciones': ['Activo',
'Inactivo']},{'label': 'Rango de Fecha', 'tipo': 'rangoFecha' }],
} %}

{% block main %}
<div class="text-neutral-800 dark:text-neutral-300 flex items-center mb-4 gap-2">
  <h1 class="text-xl dark:text-neutral-50">PÃ¡gina de inicio de la aplicacion</h1>
  {% include 'components/botonTema.html' %}
</div>
{{ datatable(data) }}
{% endblock %}

{% block footer %}
{{ super() }}
{% endblock %}

{% block scripts %}
<script>
  // Solo se puede instanciar la datatable despues de que la pagina se haya cargado completamente (no se por que)
  window.addEventListener('load', () => {
    // Obtenemos los elementos de los filtros (el id de los elementos depende de la posicion en el arreglo de filtros)
    const filtroNombre = document.querySelector('#hs-table-filter-1');
    const filtroActivo = document.querySelector('#hs-table-filter-2');
    const filtroRangoFechaInicio = document.querySelector('#hs-table-filter-3-inicio');
    const filtroRangoFechaFin = document.querySelector('#hs-table-filter-3-fin');
    // Obtenemos la instancia de la tabla
    const { dataTable } = new HSDataTable('#hs-datatable');

    // Agregamos la funcionalidad de busqueda
    dataTable.search.fixed('filters', (searchStr, data, index) => {
      // Obtenemos los datos de la fila
      const nombre = data[0];
      const estado = data[6];
      const fecha = data[4];

      // Filtramos los datos
      if (filtroRangoFechaInicio.value && filtroRangoFechaFin.value) {
        const fechaInicio = new Date(filtroRangoFechaInicio.value);
        const fechaFin = new Date(filtroRangoFechaFin.value);
        const fechaData = new Date(fecha);
        if (fechaData < fechaInicio || fechaData > fechaFin) return false;
      }
      if (filtroNombre.value && !nombre.toLowerCase().includes(filtroNombre.value.toLowerCase())) return false;
      if (filtroActivo.value && estado !== filtroActivo.value) return false;
      return true;
    });

    // Actualizamos la tabla al cambiar los filtros
    filtroNombre.addEventListener('input', () => dataTable.draw());
    filtroActivo.addEventListener('input', () => dataTable.draw());
    filtroRangoFechaInicio.addEventListener('input', () => dataTable.draw());
    filtroRangoFechaFin.addEventListener('input', () => dataTable.draw());
  });
</script>
{% endblock %}